<div class="dashboard-container">
  <app-headerdashboard [userName]="'Admin'">
    <div class="header-stats" *ngIf="dashboardData">
      <div class="stat">
        <span class="value">{{dashboardData.totalProducts}}</span>
        <span class="label">Photos</span>
      </div>
      <div class="stat">
        <span class="value">{{dashboardData.totalModerations}}</span>
        <span class="label">Modérations</span>
      </div>
      <div class="stat">
        <span class="value">{{dashboardData.totalVipUsers}}</span>
        <span class="label">Utilisateurs VIP</span>
      </div>
      <div class="stat">
        <span class="value">{{dashboardData.totalViews}}</span>
        <span class="label">Vues Totales</span>
      </div>
    </div>
  </app-headerdashboard>

  <div class="dashboard-content">
    <div class="welcome-section">
      <h1>Tableau de bord de modération</h1>
      <p>Supervisez l'activité, gérez les contenus et assurez la qualité de la plateforme</p>
    </div>

    <div class="loading" *ngIf="loading">
      <mat-spinner diameter="40"></mat-spinner>
      <span>Chargement des statistiques...</span>
    </div>

    <div *ngIf="!loading && dashboardData">
      <div class="metrics-grid">
        <app-matricecard
          [title]="'Photos en attente'"
          [value]="dashboardData.pendingApprovals"
          [change]="getDailyChange(dashboardData.pendingApprovals, 'pendingApprovals')"
          [icon]="'camera'"
          [period]="'À modérer'"
          [subtitle]="'Photos à valider'">
        </app-matricecard>

        <app-matricecard
          [title]="'Expiration proche'"
          [value]="dashboardData.expiringProducts"
          [change]="getDailyChange(dashboardData.expiringProducts, 'expiringProducts')"
          [icon]="'timer'"
          [period]="'< 48h'"
          [subtitle]="'Photos à republier'">
        </app-matricecard>

        <app-matricecard
          [title]="'Photos rejetées'"
          [value]="dashboardData.rejectedToday"
          [change]="getDailyChange(dashboardData.rejectedToday, 'rejectedToday')"
          [icon]="'block'"
          [period]="'Aujourd\'hui'"
          [subtitle]="'Non conformes'">
        </app-matricecard>

        <app-matricecard
          [title]="'Photos VIP'"
          [value]="dashboardData.vipActiveProducts"
          [change]="getDailyChange(dashboardData.vipActiveProducts, 'vipActiveProducts')"
          [icon]="'verified_user'"
          [period]="'Actives'"
          [subtitle]="'Premium'">
        </app-matricecard>

        <app-matricecard
          [title]="'Temps modération'"
          [value]="dashboardData.avgModerationTime"
          [change]="getDailyChange(dashboardData.avgModerationTime, 'avgModerationTime')"
          [icon]="'schedule'"
          [period]="'Moyen'"
          [subtitle]="'Minutes'">
        </app-matricecard>
      </div>

      <div class="charts-grid">
        <app-salechart
          [data]="dashboardData.approvalTrends"
          [title]="'Tendances Approbations'"
          [xAxisLabel]="'Mois'"
          [yAxisLabel]="'Nombre d\'approbations'"
          [chartType]="'bar'"
          [color]="'#4CAF50'">
        </app-salechart>

        <app-salechart
          [data]="dashboardData.viewTrends"
          [title]="'Tendances Vues'"
          [xAxisLabel]="'Mois'"
          [yAxisLabel]="'Nombre de vues'"
          [chartType]="'line'"
          [color]="'#2196F3'">
        </app-salechart>
      </div>

      <div class="bottom-grid">
        <app-recent
          [recentItems]="dashboardData?.recentModerations || []"
          [title]="'Actions Récentes'">
        </app-recent>

        <app-ordermatrice
          [pendingProducts]="pendingProducts"
          (approve)="onApproveProduct($event)"
          (reject)="onRejectProduct($event)">
        </app-ordermatrice>
      </div>
    </div>
  </div>
</div>
